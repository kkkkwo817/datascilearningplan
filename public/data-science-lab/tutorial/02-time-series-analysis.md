# 時間序列分析基礎

## 📊 概念總覽

時間序列分析是數據科學中一個重要的分支，專門處理按時間順序排列的數據。本教程將建立您對時間序列分析核心概念的理解，特別是在金融數據分析中的應用。

## 🎯 學習目標

學完本教程後，您將能夠：
- 理解時間序列的基本概念和特徵
- 掌握時間序列分解的原理和方法
- 了解移動平均和平滑技術
- 應用季節性檢測和異常檢測方法
- 建立時間序列分析的思維框架

## 📈 什麼是時間序列？

### 定義與特徵
時間序列是按時間順序排列的一系列數據點。與橫截面數據不同，時間序列數據具有以下特徵：

- **時間依賴性**: 當前值可能依賴於過去的值
- **趨勢性**: 長期增加或減少的模式
- **季節性**: 固定週期的重複模式
- **隨機性**: 不可預測的波動

💡 **實例說明**: 銷售數據是典型的時間序列，今天的銷售會受到昨天銷售的影響（時間依賴性），可能有長期成長趨勢（趨勢性），在某些時期有季節性波動（如聖誕節銷售高峰），同時包含隨機的市場變化。

### 時間序列的組成

```
Y(t) = Trend(t) + Seasonal(t) + Cyclical(t) + Irregular(t)
```

1. **趨勢組件 (Trend)**
   - 長期的增加或減少模式
   - 例子：經濟增長導致的股市長期上漲
   - 數學表示：線性趨勢 T(t) = a + bt

2. **季節性組件 (Seasonal)**
   - 固定週期的重複模式
   - 例子：零售業的聖誕節銷售高峰
   - 週期：通常為一年或更短

3. **週期性組件 (Cyclical)**
   - 不固定週期的波動
   - 例子：商業週期、經濟週期
   - 週期：通常超過一年且不規律

4. **不規則組件 (Irregular/Random)**
   - 隨機波動，白噪聲
   - 例子：突發事件對市場的衝擊
   - 特點：不可預測

## 🔬 時間序列分解

### 分解模型類型

#### 1. 加法模型 (Additive Model)
```
Y(t) = T(t) + S(t) + I(t)
```
- 各組件的影響是獨立相加的
- 季節性波動的幅度保持相對恆定
- 適用：季節性變化穩定的數據

#### 2. 乘法模型 (Multiplicative Model)
```
Y(t) = T(t) × S(t) × I(t)
```
- 各組件的影響是相乘的
- 季節性波動隨趨勢水平變化
- 適用：季節性變化隨水平變化的數據

💡 **實例說明**: 
- **加法模型**：氣溫數據 - 夏季比冬季高固定的度數
- **乘法模型**：銷售數據 - 聖誕節銷量是平時的2倍（比例固定）

### 主要分解方法

#### 1. 經典分解 (Classical Decomposition)
```typescript
// 基本步驟
1. 計算移動平均來估計趨勢
2. 從原始數據中減去趨勢得到去趨勢數據  
3. 計算季節性組件的平均值
4. 計算殘差組件
```

**優點**: 簡單易理解，計算快速
**缺點**: 對異常值敏感，季節性組件固定

#### 2. STL分解 (Seasonal-Trend-Loess)
```typescript
// 特點
- 使用局部加權回歸 (LOESS)
- 對異常值穩健
- 允許季節性組件隨時間變化
- 適合複雜的季節性模式
```

**優點**: 穩健性好，靈活性高
**缺點**: 計算較複雂，參數較多

#### 3. X-13ARIMA-SEATS
```typescript
// 應用領域
- 官方統計機構使用
- 經濟數據季節調整
- 高度自動化
- 包含異常值檢測
```

## 📊 移動平均與平滑技術

### 移動平均 (Moving Average)

#### 簡單移動平均 (SMA)
```typescript
MA(t) = (Y(t) + Y(t-1) + ... + Y(t-k+1)) / k
```

**應用場景**:
- 平滑短期波動
- 識別長期趨勢
- 技術分析中的支撐阻力位

**參數選擇**:
- 短期：5-10天窗口
- 中期：20-50天窗口  
- 長期：100-200天窗口

#### 加權移動平均 (WMA)
```typescript
WMA(t) = (w1×Y(t) + w2×Y(t-1) + ... + wk×Y(t-k+1)) / Σwi
```

**特點**:
- 近期數據權重更高
- 對最新變化更敏感
- 減少滯後效應

#### 指數移動平均 (EMA)
```typescript
EMA(t) = α×Y(t) + (1-α)×EMA(t-1)
```

**參數α的意義**:
- α = 0.1: 平滑程度高，反應慢
- α = 0.5: 平衡平滑和反應
- α = 0.9: 平滑程度低，反應快

💡 **實例說明**: 在股票分析中，5日EMA比5日SMA更快反映價格變化，因為它給最近的價格更高的權重。

### 高級平滑技術

#### 1. Holt線性趨勢法
```typescript
// 同時平滑水平和趨勢
Level(t) = α×Y(t) + (1-α)×(Level(t-1) + Trend(t-1))
Trend(t) = β×(Level(t) - Level(t-1)) + (1-β)×Trend(t-1)
Forecast(t+h) = Level(t) + h×Trend(t)
```

#### 2. Holt-Winters季節性方法
```typescript
// 同時處理水平、趨勢和季節性
Level(t) = α×(Y(t) - Season(t-s)) + (1-α)×(Level(t-1) + Trend(t-1))
Trend(t) = β×(Level(t) - Level(t-1)) + (1-β)×Trend(t-1)
Season(t) = γ×(Y(t) - Level(t)) + (1-γ)×Season(t-s)
```

## 🔍 季節性檢測

### 自相關函數 (ACF)
```typescript
// 計算不同滯後期的相關性
ACF(k) = Σ[(Y(t) - μ)(Y(t-k) - μ)] / Σ[(Y(t) - μ)²]
```

**解讀規則**:
- 在季節週期的整數倍處出現顯著峰值
- 峰值的大小表示季節性的強度
- 可以識別多重季節性

### 週期圖分析 (Periodogram)
```typescript
// 頻域分析方法
P(f) = |Σ[Y(t)×exp(-2πift)]|² / n
```

**優勢**:
- 可以同時檢測多個週期
- 提供頻率域的直觀視圖
- 適合複雜的季節性模式

### 季節性強度測量
```typescript
// 基於STL分解的季節性強度
SeasonalStrength = 1 - Var(Residual) / Var(Y - Trend)
```

**解釋**:
- 值接近0：無季節性
- 值接近1：強季節性
- 閾值：通常0.3以上認為有顯著季節性

## ⚠️ 異常檢測

### 基於統計的方法

#### 1. Z-score方法
```typescript
Z(t) = |Y(t) - μ| / σ
// 異常點：|Z(t)| > threshold (通常為2-3)
```

#### 2. 基於殘差的檢測
```typescript
// 在STL分解後
Z_residual(t) = |Residual(t) - μ_residual| / σ_residual
```

#### 3. 四分位距方法 (IQR)
```typescript
IQR = Q3 - Q1
Lower_bound = Q1 - 1.5 × IQR
Upper_bound = Q3 + 1.5 × IQR
// 異常點：Y(t) < Lower_bound 或 Y(t) > Upper_bound
```

### 時間序列特定的異常

#### 1. 點異常 (Point Outliers)
- 單個時間點的異常值
- 例子：股市崩盤日的極端價格

#### 2. 序列異常 (Contextual Outliers)  
- 在特定時間背景下的異常
- 例子：夏天出現的低溫

#### 3. 集體異常 (Collective Outliers)
- 一段時間內的異常模式
- 例子：金融危機期間的異常波動

💡 **實例說明**: 2020年3月COVID-19導致的股市暴跌是典型的集體異常，整個時期的行為模式都異於正常。

## 💼 金融時間序列的特殊性質

### 典型特徵

#### 1. 波動率聚集 (Volatility Clustering)
```typescript
// 高波動期後往往跟隨高波動期
// 低波動期後往往跟隨低波動期
σ(t) = f(σ(t-1), σ(t-2), ...)
```

#### 2. 厚尾分布 (Fat Tails)
```typescript
// 極端事件的概率比正態分布預期的更高
P(|Return| > 3σ) >> 0.27% (正態分布預期)
```

#### 3. 槓桿效應 (Leverage Effect)
```typescript
// 負向收益後波動率往往增加更多
Correlation(Return(t), Volatility(t+1)) < 0
```

### 常用模型

#### 1. 隨機遊走模型
```typescript
Y(t) = Y(t-1) + ε(t)
// 適用：匯率、某些股票價格
```

#### 2. ARCH/GARCH模型
```typescript
// 建模波動率的時變性
σ²(t) = α₀ + α₁×ε²(t-1) + β₁×σ²(t-1)
```

#### 3. 跳躍擴散模型
```typescript
// 考慮突然的價格跳躍
dS = μSdt + σSdW + SdJ
```

## 🔧 實際應用指南

### 數據預處理

#### 1. 數據清洗
```typescript
// 檢查缺失值
- 線性插值：適合少量缺失
- 前向填充：適合高頻數據
- 季節性插值：考慮季節模式
```

#### 2. 數據變換
```typescript
// 對數變換：穩定方差
Y_log(t) = log(Y(t))

// 差分：去除趨勢
ΔY(t) = Y(t) - Y(t-1)

// Box-Cox變換：一般化變換
Y_bc(t) = (Y(t)^λ - 1) / λ
```

### 模型選擇指南

#### 選擇分解方法
1. **數據特點評估**
   - 數據長度：短序列用簡單方法
   - 季節性複雜度：複雜用STL
   - 異常值程度：多異常值用穩健方法

2. **業務需求考慮**
   - 實時性要求：簡單方法計算快
   - 準確性要求：複雜方法更準確
   - 解釋性要求：經典方法易解釋

#### 參數調優策略
```typescript
// 季節週期選擇
- 日數據：7（週期）、30（月期）
- 月數據：12（年期）
- 季數據：4（年期）

// 平滑參數選擇
- 移動平均窗口：數據週期的1/4到1/2
- 指數平滑α：0.1-0.3（穩定），0.7-0.9（敏感）
```

## ✅ 檢查點

請回答以下問題檢驗您的理解：

1. 時間序列的四個基本組件是什麼？
2. 加法模型和乘法模型的主要區別是什麼？
3. STL分解相對於經典分解有什麼優勢？
4. 如何選擇移動平均的窗口大小？
5. 什麼是波動率聚集現象？

## 🎯 練習題

1. **組件識別**: 分析以下金融時間序列中的組件
   - 過去5年的月度股票價格
   - 每日外匯匯率
   - 每小時的加密貨幣價格

2. **方法選擇**: 為以下場景選擇合適的分解方法
   - 零售公司的月度銷售數據（有明顯季節性）
   - 製造業的日產量數據（有異常值）
   - 宏觀經濟指標的季度數據

3. **異常檢測**: 設計異常檢測策略
   - 股票交易量的突然激增
   - 信用卡交易的異常模式
   - 網站訪問量的異常波動

## 🔗 延伸閱讀

- 《Time Series Analysis: Forecasting and Control》- Box & Jenkins
- 《Forecasting: Principles and Practice》- Hyndman & Athanasopoulos  
- 《Analysis of Financial Time Series》- Ruey S. Tsay

## 💭 思考問題

1. 如何判斷一個時間序列是平穩的？為什麼平穩性很重要？
2. 在什麼情況下應該使用對數變換？
3. 如何處理具有多重季節性的時間序列？
4. 在金融風險管理中，時間序列分析扮演什麼角色？

---

**下一步**: 學習完本教程後，建議閱讀 `03-statistical-thinking.md` 來加強統計學基礎，然後實踐 Module 02 的趨勢分解器。

> 記住，時間序列分析不僅僅是技術工具，更是理解數據時間動態的思維方式。掌握這些概念將為您在金融分析、業務預測等領域提供強大的分析能力！